<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
  </head>

  <body class="min-h-screen">
    <div class="w-96 mx-auto bg-base-200 p-6 rounded-lg mt-20">
      <div class="mb-4">
        <h1 class="text-3xl font-semibold mb-1">Sign In</h1>
        <p>Sign in with your account or create one</p>
      </div>
      <div class="login-form flex flex-col mb-4">
        <div id="message" class="text-error"></div>

        <label
          id="label-username"
          class="input input-bordered flex items-center gap-2 mb-4"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 16 16"
            fill="currentColor"
            class="h-4 w-4 opacity-70"
          >
            <path
              d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM12.735 14c.618 0 1.093-.561.872-1.139a6.002 6.002 0 0 0-11.215 0c-.22.578.254 1.139.872 1.139h9.47Z"
            />
          </svg>
          <input
            id="username"
            type="text"
            class="grow"
            placeholder="Username"
          />
        </label>
        <label
          id="label-password"
          class="input input-bordered flex items-center gap-2 mb-1"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 16 16"
            fill="currentColor"
            class="h-4 w-4 opacity-70"
          >
            <path
              fill-rule="evenodd"
              d="M14 6a4 4 0 0 1-4.899 3.899l-1.955 1.955a.5.5 0 0 1-.353.146H5v1.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-2.293a.5.5 0 0 1 .146-.353l3.955-3.955A4 4 0 1 1 14 6Zm-4-2a.75.75 0 0 0 0 1.5.5.5 0 0 1 .5.5.75.75 0 0 0 1.5 0 2 2 0 0 0-2-2Z"
              clip-rule="evenodd"
            />
          </svg>
          <input
            id="password"
            type="password"
            class="grow"
            placeholder="Password"
          />
        </label>
        <a class="link link-primary no-underline font-semibold"
          >Forgot password?</a
        >
      </div>
      <div class="buttons flex flex-col">
        <button
          id="submit-btn"
          class="btn btn-primary rounded-full text-base"
          type="submit"
        >
          Sign In
        </button>

        <div class="divider px-5 my-3 text-xs">OR</div>
        <button class="btn btn-outline btn-secondary rounded-full text-base">
          Create Account
        </button>
      </div>
    </div>
    <script type="module" src="main.js"></script>
    <script>
      document
        .getElementById('submit-btn')
        .addEventListener('click', async function (event) {
          event.preventDefault()

          const username = document.getElementById('username').value
          const password = document.getElementById('password').value

          if (!username || !password) {
            document.getElementById('message').innerText =
              'Please fill in all fields'
            document
              .getElementById('label-username')
              .classList.add('ring-2', 'ring-error')
            document
              .getElementById('label-password')
              .classList.add('ring-2', 'ring-error')
            return
          }

          try {
            const response = await fetch('http://localhost:4000/login', {
              method: 'POST',
              credentials: 'include', // Importante para enviar las cookies de sesión
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ username, password }),
            })

            if (!response.ok) {
              divError.innerText = 'Credenciales inválidas'
              divError.classList.add(
                'bg-danger',
                'text-white',
                'text-center',
                'rounded',
                'p-2',
                'mt-3'
              )

              setTimeout(() => {
                divError.hidden = true
              }, 3500)

              return
            }

            const data = await response.json()
            console.log(data)
            window.location.href = 'home.html'
          } catch (error) {}
        })
    </script>
  </body>
</html>
